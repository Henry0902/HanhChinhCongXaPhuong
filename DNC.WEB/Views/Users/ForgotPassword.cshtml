@{
    ViewBag.Title = "Quên mật khẩu";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta charset="utf-8" />
    <title>Quên mật khẩu</title>
    <meta name="description" content="and Validation" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <link href="~/Content/bootstrap.min.css" rel="stylesheet" />
    <link href="~/Content/admin/maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" />
    <link href="~/Content/Css/select2.min.css" rel="stylesheet" />
    <link href="~/Content/assets/css/ace.min.css" rel="stylesheet" class="ace-main-stylesheet" id="main-ace-style" />
    <link href="~/Content/assets/css/ace-skins.min.css" rel="stylesheet" />
    <link href="~/Content/assets/css/ace-rtl.min.css" rel="stylesheet" />
    <script src="~/Content/assets/js/ace-extra.min.js"></script>
    <link href="~/Content/Css/custom.css" rel="stylesheet" />
    <script src="~/Content/admin/ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="~/Scripts/angular.min.js"></script>
    <script src="~/Scripts/angular-cookie/angular-cookies.js"></script>
    <script src="~/Scripts/angular-route.min.js"></script>
    <script src="~/Scripts/angular-ui/ui-bootstrap.js"></script>
    <script src="~/ScriptController/crud.js"></script>

    <style>
        .help-block {
            font-style: italic !important;
        }

        .b-r-4 {
            border-radius: 4px;
        }

        .steps.w-86{
            width: 86% !important;
        }

        .btn:focus {
            outline: none !important;
        }

        .btn-success:hover {
            border-color: #629B58 !important;
            opacity: 0.8;
        }

        .btn-back:hover {
            border-color: #8B9AA3 !important;
            opacity: 0.8;
        }

        .captcha:hover {
            opacity: 0.8;
        }
    </style>
</head>

<body class="no-skin" ng-app="myApp" style="height: 100vh">
    <script src="~/ScriptController/ForgotPasswordJs.js"></script>
    <div class="main-container ace-save-state" id="main-container" ng-controller="ForgotPasswordJs" style="height: 100%">
        <script type="text/javascript">
            try { ace.settings.loadState('main-container') } catch (e) { }
        </script>

        <div class="main-content" style="background-color: white !important">
            <div class="main-content-inner">
                <div class="page-content">
                    <div class="row">
                        <div class="col-xs-12">
                            <div class="widget-box" style="border: none !important">
                                <div class="widget-body">
                                    <div class="widget-main">
                                        <div id="fuelux-wizard-container">
                                            <div class="text-center">
                                                <span class="profile-picture" style="border: none !important; box-shadow: none !important;">
                                                    <img id="avatar" class="editable img-responsive" alt="Logo" src="~/Content/assets/images/quochuy.png" style="width: 120px" />
                                                </span>
                                            </div>
                                            <h2 class="text-center" style="color: #438EB9; font-weight: bold">HỆ THỐNG ĐĂNG KÝ TIẾP DÂN TUYÊN QUANG</h2>
                                            <h3 class="text-center" style="color: #181D27; font-weight: bold">{{ currentStep == 3 ? 'NHẬP MẬT KHẨU MỚI': 'QUÊN MẬT KHẨU'}}</h3>
                                            <div class="step-content pos-rel" style="margin-top: 24px">
                                                <div ng-show="currentStep == 1">
                                                    <div class="row" style="display: flex; justify-content: center;">
                                                        <div class="col-md-5">
                                                            <form class="form-horizontal" id="form-captcha" method="get">
                                                                <div class="form-group">
                                                                    <label class="no-padding-right" for="phoneNumber">Số điện thoại <span class="red"> *</span></label>
                                                                    <div class="clearfix" style="margin-bottom: 5px">
                                                                        <input type="tel" name="phoneNumber" id="phoneNumber" onkeypress="return isNumber(event)" maxlength="10" ng-model="formData.Mobile" ng-pattern="/^0[0-9]{9}$/" placeholder="Nhập..." required style="width: 100%; border-radius: 4px !important" />
                                                                    </div>
                                                                </div>
                                                                <div class="form-group">
                                                                    <label class="no-padding-right" for="confirmPassword">Giải bài toán math captcha <span class="red"> *</span></label>
                                                                    <div class="clearfix" style="display: flex; flex-direction: row; align-items: center; margin-bottom: 3px">
                                                                        <div style="display: flex; flex-direction: row; flex: 2; margin-right: 6px">
                                                                            <input type="text" disabled trim-input maxlength="100" ng-model="captcha.question" style="min-width: 54px; width: 100%; text-align: center; border-radius: 4px !important;" />
                                                                            <span style="margin-left: 6px; align-content: center">=</span>
                                                                        </div>
                                                                        <input type="text" trim-input name="captcha" onkeypress="return isNumber(event)" id="captcha" maxlength="2" placeholder="Nhập..." ng-model="userAnswer" required style="width: 100%; border-radius: 4px !important; flex: 12; margin-right: 6px" />
                                                                        <button type="button" ng-click="loadCaptcha()" class="b-r-4 captcha" style="background: #4a4a4a; min-width: 100px; color: white; height: 32px; border: none; cursor: pointer; flex: 3">
                                                                            <img src="~/Content/assets/images/btn_tao_lai.png" />
                                                                            Tạo lại mã
                                                                        </button>
                                                                    </div>
                                                                    <span class="red" style="font-style: italic;" ng-if="message && !success">{{message}}</span>
                                                                </div>
                                                            </form>
                                                            <div class="text-center" style="display: flex; margin-top: 24px; flex-direction: column; gap: 10px; margin-left: -15px; margin-right: -15px;">
                                                                <button type="button" class="btn btn-success b-r-4" ng-click="onConfirm()">Xác nhận</button>
                                                                <a href="/" style="cursor:pointer;">Quay về màn đăng nhập</a>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div ng-show="currentStep == 2">
                                                    <div style="display: flex; flex-direction: column; align-items: center;">
                                                        <div style="margin-top: 24px; font-size: 14px">Nhập mã OTP đã được gửi tới tài khoản số điện thoại <span style="font-weight: bold">{{formData.Mobile}}</span> đã đăng ký</div>
                                                        <div style="display: flex; gap: 10px; justify-content: center; margin-top: 24px">
                                                            <input type="text" ng-attr-id="otp-input-{{$index}}" ng-keyup="moveNext($event, $index)" oninput="this.value = this.value.replace(/\D/g, '')" ng-repeat="num in numbers track by $index" ng-model="numbers[$index]" maxlength="1" style="width: 40px; height: 40px; border-radius: 3px !important; text-align: center;">
                                                        </div>
                                                        <div style="margin-top: 24px; display: flex; flex-direction: row">
                                                            <div style="display: flex; flex-direction: column">
                                                                <input type="text" ng-value="'Thời gian còn lại ' + countdownDisplay" disabled style="margin-bottom: 4px; border-radius: 3px !important; width: 250px; padding: 5px; border: 1px solid #ccc; background: #f8f8f8; font-weight: bold;">
                                                                <span class="red" style="font-style: italic" ng-show="countdown == 0">Hết thời gian nhập mã OTP</span>
                                                            </div>
                                                            <button ng-click="sendAgain()" ng-disabled="countdown > 0" class="b-r-4" style="background: #4a4a4a; color: white; height: 32px; border: none; cursor: pointer; margin-left: 10px">
                                                                Gửi lại
                                                            </button>
                                                        </div>
                                                        <div class="text-center" style="margin-top: 24px;">
                                                            <button ng-click="onBack()" class="btn btn-back b-r-4"><i class="ace-icon fa fa-arrow-left"></i> Trở lại</button>
                                                            <button type="button" ng-click="onContinue()" class="btn btn-success b-r-4" ng-disabled="countdown == 0 || checkNull()">Tiếp tục  <i class="ace-icon fa fa-arrow-right icon-on-right"></i></button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div ng-show="currentStep == 3">
                                                    <div class="row" style="display: flex; justify-content: center;">
                                                        <form class="form-horizontal col-md-5" id="form-password" method="get">
                                                            <div class="form-group">
                                                                <label class="no-padding-right" for="password">Mật khẩu <span class="red"> *</span></label>
                                                                <div class="clearfix">
                                                                    <input type="password" name="password" id="password" maxlength="12" minlength="6" ng-model="formData.Password" ng-pattern="/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{6,20}$/" required placeholder="Nhập..." style="width: 100%; border-radius: 4px !important" />
                                                                </div>
                                                            </div>
                                                            <div class="form-group">
                                                                <label class="no-padding-right" for="confirmPassword">Nhập lại mật khẩu <span class="red"> *</span></label>
                                                                <div class="clearfix">
                                                                    <input type="password" name="confirmPassword" id="confirmPassword" maxlength="12" minlength="6" ng-model="formData.ConfirmPassword" required class="form-control" placeholder="Nhập..." style="width: 100%; border-radius: 4px !important" />
                                                                </div>
                                                                <div style="display: flex; flex-direction: column; margin-top: 16px; border: 1px solid #ccc; border-radius: 4px !important">
                                                                    <span style="padding: 2px 6px; background: #f8f8f8; color: #414651;">
                                                                        {{formatText}}
                                                                    </span>
                                                                    <span style="padding: 2px 6px; background: #f8f8f8; color: #414651; ">
                                                                        Phân biệt hoa, thường.
                                                                    </span>
                                                                    <span style="padding: 2px 6px; background: #f8f8f8; color: #414651; ">
                                                                        Giới hạn từ 6 đến 12 ký tự.
                                                                    </span>
                                                                </div>
                                                            </div>
                                                            <div class="text-center" style="margin-top: 24px !important; display: flex; gap: 6px; margin-left: -15px; margin-right: -15px;">
                                                                <button class="btn b-r-4 btn-back" style="flex: 1" ng-click="onClose()">Huỷ</button>
                                                                <button type="button" ng-click="onComplete()" class="btn btn-success b-r-4" style="flex: 1">Xác nhận</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                                <div ng-show="currentStep == 4">
                                                    <div style="display: flex; justify-content: center">
                                                        <div style="margin-top: 24px" class=" col-md-7">
                                                            <div class="alert alert-success d-flex align-items-start p-3 b-r-4">
                                                                <div class="me-2">
                                                                    <strong>✔ Thành công! </strong>
                                                                </div>
                                                                <div>
                                                                    Đổi mật khẩu thành công! Mật khẩu đã được đổi thành công. Xin vui lòng đăng nhập lại.
                                                                </div>
                                                            </div>
                                                            <a class="btn btn-success px-4 b-r-4" href="/">Trở về màn hình chính</a>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-sm btn-inverse">
            <i class="ace-icon fa fa-angle-double-up icon-only bigger-110"></i>
        </a>
    </div>

    <div id="divLoading" style="margin: 0px; padding: 0px; position: fixed; right: 0px; top: 0px; width: 100%; height: 100%; background-color: transparent; z-index: 30001; opacity: .8; filter: alpha(opacity=70); display: none">
        <p style="position: absolute; top: 46%; left: 50%; color: #ff6a00; text-align: center">
            <i class="fa fa-spinner fa-pulse fa-3x fa-spin fa-fw margin-bottom"></i><br />
            Vui lòng đợi...
        </p>
    </div>

    <script src="~/Content/assets/js/jquery-2.1.4.min.js"></script>
    <script type="text/javascript">
        if ('ontouchstart' in document.documentElement) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>" + "<" + "/script>");
    </script>
    <script src="~/Content/assets/js/bootstrap.min.js"></script>

    <!-- page specific plugin scripts -->
    <script src="~/Content/assets/js/wizard.min.js"></script>
    <script src="~/Content/assets/js/jquery.validate.min.js"></script>
    <script src="~/Content/assets/js/jquery-additional-methods.min.js"></script>
    <script src="~/Content/assets/js/bootbox.js"></script>
    <script src="~/Content/assets/js/jquery.maskedinput.min.js"></script>
    <script src="~/Content/assets/js/select2.min.js"></script>

    <!-- ace scripts -->
    <script src="~/Content/assets/js/ace-elements.min.js"></script>
    <script src="~/Content/assets/js/ace.min.js"></script>
    <script src="~/Content/assets/js/bootstrap-datepicker.min.js"></script>
    <script src="~/Content/assets/js/bootstrap-timepicker.min.js"></script>
    <link href="~/Content/assets/css/datepicker.min.css" rel="stylesheet" />
    <script src="~/Scripts/notify.min.js"></script>
    <!-- inline scripts related to this page -->
    <script type="text/javascript">
        let today = new Date();
        $('.date-picker').datepicker({
            format: 'dd/mm/yyyy',
            endDate: today, // Không cho chọn ngày nhỏ hơn hôm nay
            autoclose: true,
            todayHighlight: true
        }).on('changeDate', function (e) {
        });

        function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        jQuery(function ($) {
            $('[data-rel=tooltip]').tooltip();
            $('.select2').css('width', '200px').select2({ allowClear: true })
                .on('change', function () {
                    $(this).closest('form').validate().element($(this));
                });

            jQuery.validator.addMethod("phone", function (value, element) {
                return this.optional(element) || /^\(\d{3}\) \d{3}\-\d{4}( x\d{1,6})?$/.test(value);
            }, "Enter a valid phone number.");

            $('#form-password').validate({
                errorElement: 'div',
                errorClass: 'help-block',
                focusInvalid: false,
                ignore: "",
                rules: {
                    password: {
                        required: true,
                        minlength: 6
                    },
                    confirmPassword: {
                        required: true,
                        minlength: 6,
                        equalTo: "#password"
                    },
                },
                messages: {
                    password: {
                        required: "Trường dữ liệu này không được để trống",
                        minlength: "Vui lòng nhập ít nhất 6 ký tự"
                    },
                    confirmPassword: {
                        required: "Trường dữ liệu này không được để trống",
                        minlength: "Vui lòng nhập ít nhất 6 ký tự",
                        equalTo: "Mật khẩu nhập lại không khớp"
                    },
                },
                highlight: function (e) {
                    $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
                },
                success: function (e) {
                    $(e).closest('.form-group').removeClass('has-error');
                    $(e).remove();
                },
                errorPlacement: function (error, element) {
                    if (element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
                        var controls = element.closest('div[class*="col-"]');
                        if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                        else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                    }
                    else if (element.is('.select2')) {
                        error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                    }
                    else if (element.is('.chosen-select')) {
                        error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                    }
                    else error.insertAfter(element.parent());
                },
                submitHandler: function (form) {
                },
                invalidHandler: function (form) {
                }
            });

            $('#form-captcha').validate({
                errorElement: 'div',
                errorClass: 'help-block',
                focusInvalid: false,
                ignore: "",
                rules: {
                    phoneNumber: {
                        required: true,
                        digits: true,
                        minlength: 10,
                        maxlength: 10
                    },
                    captcha: {
                        required: true,
                    },
                },
                messages: {
                    phoneNumber: {
                        required: "Trường dữ liệu này không được để trống",
                        minlength: "Vui lòng nhập ít nhất 10 ký tự",
                        maxlength: "Vui lòng nhập tối đa 10 ký tự",
                    },
                    captcha: {
                        required: "Trường dữ liệu này không được để trống",
                    },
                },

                highlight: function (e) {
                    $(e).closest('.form-group').removeClass('has-info').addClass('has-error');
                },

                success: function (e) {
                    $(e).closest('.form-group').removeClass('has-error');
                    $(e).remove();
                },

                errorPlacement: function (error, element) {
                    if (element.is('input[type=checkbox]') || element.is('input[type=radio]')) {
                        var controls = element.closest('div[class*="col-"]');
                        if (controls.find(':checkbox,:radio').length > 1) controls.append(error);
                        else error.insertAfter(element.nextAll('.lbl:eq(0)').eq(0));
                    }
                    else if (element.is('.select2')) {
                        error.insertAfter(element.siblings('[class*="select2-container"]:eq(0)'));
                    }
                    else if (element.is('.chosen-select')) {
                        error.insertAfter(element.siblings('[class*="chosen-container"]:eq(0)'));
                    }
                    else error.insertAfter(element.parent());
                },

                submitHandler: function (form) {
                },
                invalidHandler: function (form) {
                }
            });

            $('#modal-wizard-container').ace_wizard();
            $('#modal-wizard .wizard-actions .btn[data-dismiss=modal]').removeAttr('disabled');
            $(document).one('ajaxloadstart.page', function (e) {
                $('[class*=select2]').remove();
            });
        })
    </script>
</body>
</html>